var R=Object.defineProperty;var F=(s,e,t)=>e in s?R(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var D=(s,e,t)=>(F(s,typeof e!="symbol"?e+"":e,t),t);import{bd as x,O as c,b5 as A,m as w,b0 as b,be as V,d as $,r as y,a2 as z,$ as B,l as T,o as l,c as u,a as i,b as h,R as p,N as U,a6 as _,Q as j,ab as k,aj as K,a1 as I,ah as C,a5 as E,ac as L,a3 as S,aS as P,a4 as Y,X as G,aa as H,aV as J,bb as Q}from"./index-3af22ecb.js";class M{constructor(){D(this,"localKey","luma-store")}save(e){if(!e.id)throw"id must";let t=this.getObjs(),r=t.findIndex(v=>v.id==e.id);return r>-1?t[r]=e:t.push(e),x.set(this.localKey,t),this}findIndex(e){return this.getObjs().findIndex(t=>t.id==e)}getObjs(){const e=x.get(this.localKey);return e||[]}}function X(){let s={};if(c.myData.vtoken){const t={"x-vtoken":c.myData.vtoken,"x-ctoken":c.myData.ctoken};s={...s,...t}}if(!b.myData.LUMA_KEY){const t=V();if(t.token){const r={"x-ptoken":t.token};return s={...s,...r},s}return s}const e={Authorization:"Bearer "+b.myData.LUMA_KEY};return s={...s,...e},s}const q=s=>s.indexOf("http")==0?s:b.myData.LUMA_SERVER?`${b.myData.LUMA_SERVER}/luma${s}`:`/luma${s}`,N=(s,e,t)=>{w("sunoFetch",s);let r={"Content-Type":"application/json"};return t&&t.headers&&(r=t.headers),r={...r,...X()},new Promise((v,d)=>{let m={method:"GET"};m.headers=r,t!=null&&t.upFile?(m.method="POST",m.body=e):e&&(m.body=JSON.stringify(e),m.method="POST"),fetch(q(s),m).then(async a=>{var f;if(!a.ok){let o="发生错误: "+a.status;try{let n=await a.json();o="("+a.status+")发生错误: "+(((f=n==null?void 0:n.error)==null?void 0:f.message)??"")}catch{}throw c.myData.ms&&c.myData.ms.error(o),new Error(o)}a.json().then(o=>v(o)).catch(o=>{c.myData.ms&&c.myData.ms.error("发生错误"+o),d(o)})}).catch(a=>{a.name==="TypeError"&&a.message==="Failed to fetch"?c.myData.ms&&c.myData.ms.error("跨域|CORS error"):c.myData.ms&&c.myData.ms.error("发生错误:"+a),w("e",a.stat),d(a)})})},O=async s=>{if(s=="")return"";const e=new M;for(let t=0;t<120;t++){let r=await N("/generations/"+s);if(r.id&&(r.last_feed=new Date().getTime(),e.save(r),c.setMyData({act:"FeedLumaTask"}),r.state=="completed"))break;await A(5*1e3)}},W={class:"p-2"},Z={class:"pt-1"},ee={class:"flex justify-between items-end"},te=["src"],se={key:1,class:"text-center"},ae={class:"pb-1 text-right"},oe=$({__name:"voInput",setup(s){const e=y({aspect_ratio:"16:9",expand_prompt:!0,image_url:"",user_prompt:""}),t=y({isDo:!1}),r=z(),v=y();B(()=>{c.setMyData({ms:r})});const d=T(()=>e.value.user_prompt!=""&&!t.value.isDo),m=async()=>{if(w("generate",e.value),t.value.isDo=!0,!d){r.error(S("video.plsInput"));return}try{const o=await N("/generations/",e.value);w("d",o),O(o.id),r.success(S("video.submitSuccess"))}catch{}t.value.isDo=!1};function a(o){P(o.target.files[0]).then(n=>{e.value.image_url=n,v.value=""}).catch(n=>r.error(n))}const f=()=>{e.value.user_prompt="",e.value.image_url=""};return(o,n)=>(l(),u("div",W,[i("div",null,[h(p(U),{value:e.value.user_prompt,"onUpdate:value":n[0]||(n[0]=g=>e.value.user_prompt=g),placeholder:o.$t("video.descpls"),type:"textarea",size:"small",autosize:{minRows:3,maxRows:12}},null,8,["value","placeholder"])]),i("div",Z,[i("div",ee,[i("div",null,[i("input",{type:"file",onChange:a,ref_key:"fsRef",ref:v,style:{display:"none"},accept:"image/jpeg, image/jpg, image/png, image/gif"},null,544),i("div",{class:"h-[80px] w-[80px] overflow-hidden rounded-sm border border-gray-400/20 flex justify-center items-center cursor-pointer",onClick:n[1]||(n[1]=g=>v.value.click())},[e.value.image_url?(l(),u("img",{key:0,src:e.value.image_url},null,8,te)):(l(),u("div",se,_(o.$t("video.selectimg")),1))])]),i("div",null,[i("div",ae,[e.value.user_prompt!=""||e.value.image_url!=""?(l(),j(p(K),{key:0,type:"success",size:"small",round:""},{default:k(()=>[i("span",{class:"cursor-pointer",onClick:n[2]||(n[2]=g=>f())},_(o.$t("video.clear")),1)]),_:1})):I("",!0)]),i("div",null,[h(p(L),{loading:t.value.isDo,type:"primary",disabled:!p(d),onClick:n[3]||(n[3]=g=>m())},{default:k(()=>[h(p(C),{icon:"ri:video-add-line"}),E(" "+_(o.$t("video.generate")),1)]),_:1},8,["loading","disabled"])])])])])]))}}),re={key:0,class:"p-4"},ne={class:"grid grid-cols-1 gap-5 md:grid-cols-2 lg:grid-cols-3"},ie=["onMousemove"],le={class:"relative flex items-center justify-center bg-white bg-opacity-10 rounded-[16px] overflow-hidden aspect-[16/8.85]"},ce=["src","controls"],de={key:1,class:"text-center"},ue={key:1,class:"pt-2"},me={class:"flex justify-between items-center"},ve={class:"line-clamp-1"},pe={class:"max-w-[300px]"},fe=["href"],_e={key:1,class:"w-full h-full flex justify-center items-center"},he=$({__name:"voList",setup(s){const e=y({pIndex:-1}),t=y([]),r=new M,v=()=>{let d=r.getObjs();t.value=d.reverse()};return T(()=>new Date().getTime()),Y(()=>c.myData.act,d=>{d=="FeedLumaTask"&&v()}),v(),(d,m)=>t.value.length>0?(l(),u("div",re,[i("div",ne,[(l(!0),u(G,null,H(t.value,(a,f)=>{var o,n;return l(),u("div",{key:f,class:"relative",onMousemove:g=>e.value.pIndex=f,onMouseout:m[0]||(m[0]=g=>e.value.pIndex=-1)},[i("div",le,[a.video?(l(),u("video",{key:0,src:(o=a.video)==null?void 0:o.url,loop:"",playsinline:"",controls:e.value.pIndex==f,class:"w-full h-full object-cover"},null,8,ce)):(l(),u("div",de,[!a.last_feed||new Date().getTime()-a.last_feed>20*1e3?(l(),j(p(L),{key:0,size:"small",type:"primary",onClick:g=>p(O)(a.id)},{default:k(()=>[E(_(d.$t("video.repeat")),1)]),_:2},1032,["onClick"])):(l(),u("div",ue,_(d.$t("video.process"))+_(new Date(a.last_feed).toLocaleString()),1))]))]),i("div",me,[i("div",null,[h(p(J),{trigger:"hover"},{trigger:k(()=>[i("div",ve,_(a.prompt),1)]),default:k(()=>[i("div",pe,_(a.prompt),1)]),_:2},1024)]),i("div",null,[a.video?(l(),u("a",{key:0,href:(n=a.video)==null?void 0:n.url,download:"",target:"_blank"},[h(p(C),{icon:"mdi:download",class:"cursor-pointer"})],8,fe)):I("",!0)])])],40,ie)}),128))])])):(l(),u("div",_e,[h(p(Q),{description:d.$t("video.nodata")},null,8,["description"])]))}}),ge={class:"flex w-full h-full"},ye={class:"w-[300px] h-full overflow-y-auto"},ke={class:"flex-1 h-full bg-[#fafbfc] pt-2 dark:bg-[#18181c] overflow-y-auto"},$e=$({__name:"video",setup(s){return(e,t)=>(l(),u("div",ge,[i("div",ye,[h(oe)]),i("div",ke,[h(he)])]))}});export{$e as default};
